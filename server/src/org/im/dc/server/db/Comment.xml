<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="Comment">
	<select id="retrieveUserComment" resultType="RecComment"
		resultMap="RecCommentMap">
		SELECT Comments.*, Articles.words
		FROM Comments, Articles
		WHERE
		Comments.articleId = Articles.articleId
		AND (Articles.assignedUsers @>
		ARRAY[#{user}]::varchar[][] OR
		Articles.watchers @>
		ARRAY[#{user}]::varchar[][])
	</select>
	<resultMap id="RecCommentMap" type="RecComment">
		<id property="commentId" column="commentId" />
		<result property="words" column="words" typeHandler="StringArrayTypeHandler" />
	</resultMap>
</mapper>
